<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyTech Gadgets Catalog</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .scroll-container::-webkit-scrollbar { display: none; }
        .scroll-container { -ms-overflow-style: none; scrollbar-width: none; }
        .nav-active {
            border-bottom-width: 2px;
            border-color: #0d9488;
            color: #0d9488;
            font-weight: 600;
        }
        .gallery-thumbnail-active { border-color: #0d9488; }

        /* Shimmer Animation for Skeleton Loader */
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        .animate-shimmer {
            animation: shimmer 2s infinite linear;
            background: linear-gradient(to right, #f6f7f8 4%, #edeef1 25%, #f6f7f8 36%);
            background-size: 1000px 100%;
        }
    </style>
</head>
<body class="antialiased">

<div id="app" class="min-h-screen pb-16">
    <!-- Header -->
    <header class="sticky top-0 z-30 bg-white shadow-sm">
        <div class="max-w-4xl mx-auto p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between">
            <h1 class="text-2xl font-extrabold text-teal-700 tracking-tight text-center sm:text-left">
                <span class="text-gray-900">MyTech</span> Gadgets
            </h1>
            <nav class="mt-3 sm:mt-0 flex justify-center space-x-6">
                <button id="nav-products" onclick="showView('products')" class="nav-btn text-sm font-medium uppercase tracking-wider py-1 transition nav-active">Products</button>
                <button id="nav-about" onclick="showView('about')" class="nav-btn text-sm font-medium uppercase tracking-wider py-1 text-gray-500 hover:text-teal-600 transition">About</button>
            </nav>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 mt-6">
        <!-- == PRODUCT PAGE == -->
        <div id="product-page">
            <!-- Category Tabs -->
            <div id="main-category-tabs" class="mb-4 overflow-x-auto whitespace-nowrap scroll-container border-b border-gray-200 pb-3 min-h-[50px]">
                 <!-- Categories will load here -->
                 <div id="category-skeleton" class="flex space-x-2">
                     <div class="h-8 w-24 bg-gray-200 rounded-full animate-pulse"></div>
                     <div class="h-8 w-24 bg-gray-200 rounded-full animate-pulse"></div>
                     <div class="h-8 w-24 bg-gray-200 rounded-full animate-pulse"></div>
                 </div>
            </div>

            <!-- Sub Category Tabs -->
            <div id="subcategory-container" class="mb-6 overflow-x-auto whitespace-nowrap scroll-container hidden">
                <div id="subcategory-buttons" class="flex"></div>
            </div>

            <!-- Product Grid -->
            <section id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- SKELETON LOADER (Shows while real data is loading) -->
                <div id="skeleton-loader" class="col-span-1 sm:col-span-2 lg:col-span-3 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- 6 Fake Product Cards -->
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-gray-100 h-96">
                        <div class="h-48 bg-gray-200 animate-shimmer"></div>
                        <div class="p-4 space-y-3">
                            <div class="h-4 bg-gray-200 rounded animate-shimmer w-1/3"></div>
                            <div class="h-6 bg-gray-200 rounded animate-shimmer w-3/4"></div>
                            <div class="h-8 bg-gray-200 rounded animate-shimmer w-1/2"></div>
                            <div class="h-10 bg-gray-200 rounded animate-shimmer w-full mt-4"></div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-gray-100 h-96 hidden sm:block">
                        <div class="h-48 bg-gray-200 animate-shimmer"></div>
                        <div class="p-4 space-y-3">
                            <div class="h-4 bg-gray-200 rounded animate-shimmer w-1/3"></div>
                            <div class="h-6 bg-gray-200 rounded animate-shimmer w-3/4"></div>
                            <div class="h-8 bg-gray-200 rounded animate-shimmer w-1/2"></div>
                            <div class="h-10 bg-gray-200 rounded animate-shimmer w-full mt-4"></div>
                        </div>
                    </div>
                     <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-gray-100 h-96 hidden lg:block">
                        <div class="h-48 bg-gray-200 animate-shimmer"></div>
                        <div class="p-4 space-y-3">
                            <div class="h-4 bg-gray-200 rounded animate-shimmer w-1/3"></div>
                            <div class="h-6 bg-gray-200 rounded animate-shimmer w-3/4"></div>
                            <div class="h-8 bg-gray-200 rounded animate-shimmer w-1/2"></div>
                            <div class="h-10 bg-gray-200 rounded animate-shimmer w-full mt-4"></div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Status Messages -->
            <div id="status-message" class="text-center p-12 hidden">
                <p class="text-gray-500">No products found in this category.</p>
            </div>
             <div id="error-message" class="text-center p-12 hidden text-red-500"></div>
        </div>

        <!-- == ABOUT PAGE (Same as before, simplified for brevity in this update) == -->
        <div id="about-page" class="hidden">
             <section class="mb-6 p-6 bg-white rounded-xl shadow-sm border border-gray-100">
                <h2 class="text-2xl font-bold text-teal-700 mb-4">About MyTech Gadgets</h2>
                <p class="text-gray-700 mb-4">Welcome! I am an Easy Ship seller on Amazon and a trusted seller on Meesho and Snapdeal. MyTech Gadgets is my direct catalog for high-quality, curated electronics in India.</p>
                 <h3 class="text-xl font-bold text-gray-800 mb-3">Contact Us</h3>
                 <p class="text-gray-600">Email: mytech-gadgets@example.com<br>WhatsApp: +91 98765 43210</p>
            </section>
        </div>
    </main>
</div>

<!-- Gallery Modal (Hidden initially) -->
<div id="product-gallery-modal" class="fixed inset-0 z-40 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 hidden" onclick="closeProductGallery()">
    <div class="bg-white rounded-xl shadow-2xl overflow-hidden w-full max-w-md m-auto transform transition-all duration-300 scale-95 flex flex-col max-h-[90vh]" onclick="event.stopPropagation()">
        <div class="relative bg-gray-100 flex-shrink-0">
            <button onclick="closeProductGallery()" class="absolute top-3 right-3 z-50 bg-white rounded-full p-1 shadow-md text-gray-500 hover:text-gray-800 focus:outline-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <img id="gallery-main-image" src="" alt="Product" class="w-full h-64 object-contain p-4">
        </div>
        <div id="gallery-thumbnails" class="flex space-x-2 p-3 bg-white border-b overflow-x-auto flex-shrink-0 min-h-[60px]"></div>
        <div class="p-5 overflow-y-auto">
            <span id="gallery-category-badge" class="text-xs font-semibold text-teal-600 bg-teal-50 px-2 py-1 rounded-full"></span>
            <h3 id="gallery-title" class="text-xl font-bold text-gray-900 mt-2 leading-tight"></h3>
            <p id="gallery-price" class="text-2xl font-extrabold text-teal-700 my-3"></p>
            <p id="gallery-description" class="text-gray-600 text-sm leading-relaxed mb-6"></p>
            <a id="gallery-buy-btn" href="#" class="block w-full text-center py-3 rounded-lg text-white font-bold bg-rose-600 hover:bg-rose-700 transition shadow-md active:transform active:scale-95">
                INQUIRE / BUY NOW
            </a>
        </div>
    </div>
</div>

<!-- Purchase Modal -->
<div id="purchase-message-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end sm:items-center justify-center hidden">
    <div class="bg-white w-full sm:max-w-sm sm:rounded-xl p-6 animate-slide-up sm:animate-none">
        <h4 class="text-lg font-bold text-gray-900 mb-2">How to Buy</h4>
        <p id="purchase-message-text" class="text-gray-700 mb-6"></p>
        <button onclick="closePurchaseModal()" class="w-full py-3 bg-gray-100 text-gray-800 font-bold rounded-lg hover:bg-gray-200">Close</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, onSnapshot, enableIndexedDbPersistence } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // Global State
    let allProducts = [];
    let currentCategory = 'All', currentSubcategory = 'All';
    const elements = {
        productGrid: document.getElementById('product-grid'),
        skeletonLoader: document.getElementById('skeleton-loader'),
        mainCatTabs: document.getElementById('main-category-tabs'),
        catSkeleton: document.getElementById('category-skeleton'),
        subCatContainer: document.getElementById('subcategory-container'),
        subCatButtons: document.getElementById('subcategory-buttons'),
        statusMsg: document.getElementById('status-message'),
        errorMsg: document.getElementById('error-message'),
        productPage: document.getElementById('product-page'),
        aboutPage: document.getElementById('about-page'),
        navProducts: document.getElementById('nav-products'),
        navAbout: document.getElementById('nav-about'),
        galleryModal: document.getElementById('product-gallery-modal'),
        purchaseModal: document.getElementById('purchase-message-modal')
    };

    // Firebase Init
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
    let db, auth;

    async function initApp() {
        if (!firebaseConfig.apiKey) { showError("Configuration Error."); return; }
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            // Try to enable offline persistence (caches data for faster 2nd load)
            try { await enableIndexedDbPersistence(db); } catch (err) { console.log("Persistence disabled"); }

            onAuthStateChanged(auth, user => {
                if (user) { loadProducts(); }
                else { signInAnonymously(auth).catch(e => showError(e.message)); }
            });
        } catch (e) { showError("Failed to connect."); }
    }

    function loadProducts() {
        onSnapshot(collection(db, `/artifacts/${appId}/public/data/products`), (snapshot) => {
            allProducts = [];
            snapshot.forEach(doc => allProducts.push({ id: doc.id, ...doc.data() }));
            
            // Data loaded! Hide skeletons, show real content.
            elements.catSkeleton.classList.add('hidden');
            elements.skeletonLoader.classList.add('hidden');
            
            renderCategories();
            filterProducts(currentCategory, currentSubcategory);
        }, (error) => showError("Could not load products. Check internet connection."));
    }

    // UI Rendering
    function renderCategories() {
        const cats = ['All', ...new Set(allProducts.map(p => p.category))];
        // Keep only the skeleton or 'All' button initially, then rebuild
        elements.mainCatTabs.innerHTML = ''; 
        cats.forEach(cat => {
            const btn = document.createElement('button');
            btn.className = `category-btn inline-flex items-center px-4 py-2 mr-2 text-sm font-medium rounded-full transition shadow-sm border ${cat === currentCategory ? 'bg-teal-600 text-white border-transparent' : 'bg-white text-gray-700 border-gray-200'}`;
            btn.textContent = cat === 'All' ? 'All Products' : cat;
            btn.onclick = () => filterProducts(cat, 'All');
            elements.mainCatTabs.appendChild(btn);
        });
    }

    window.filterProducts = (cat, sub) => {
        currentCategory = cat; currentSubcategory = sub;
        
        // Update Main Category Buttons
        Array.from(elements.mainCatTabs.children).forEach(btn => {
             const isActive = (btn.textContent === 'All Products' && cat === 'All') || (btn.textContent === cat);
             btn.className = `category-btn inline-flex items-center px-4 py-2 mr-2 text-sm font-medium rounded-full transition shadow-sm border ${isActive ? 'bg-teal-600 text-white border-transparent' : 'bg-white text-gray-700 border-gray-200'}`;
        });

        // Handle Subcategories
        if (cat === 'All') {
            elements.subCatContainer.classList.add('hidden');
        } else {
            const subs = [...new Set(allProducts.filter(p => p.category === cat).map(p => p.subcategory))].filter(Boolean);
            if (subs.length > 0) {
                elements.subCatContainer.classList.remove('hidden');
                elements.subCatButtons.innerHTML = '';
                ['All', ...subs].forEach(s => {
                    const btn = document.createElement('button');
                    btn.className = `subcategory-btn inline-flex items-center px-3 py-1 mr-2 text-xs font-medium rounded-full transition border ${s === sub ? 'bg-teal-100 text-teal-700 border-teal-200' : 'bg-white text-gray-600 border-gray-200'}`;
                     btn.textContent = s === 'All' ? 'All' : s;
                    btn.onclick = () => filterProducts(cat, s);
                    elements.subCatButtons.appendChild(btn);
                });
            } else {
                 elements.subCatContainer.classList.add('hidden');
            }
        }

        // Filter and Render Products
        let filtered = allProducts;
        if (cat !== 'All') filtered = filtered.filter(p => p.category === cat);
        if (sub !== 'All') filtered = filtered.filter(p => p.subcategory === sub);

        elements.statusMsg.classList.toggle('hidden', filtered.length > 0);
        // Clear previous REAL products only (keep skeleton if it was there, though it should be hidden by now)
        Array.from(elements.productGrid.children).forEach(child => {
            if (child.id !== 'skeleton-loader') child.remove();
        });

        filtered.forEach(product => {
             const img = (product.imageUrls && product.imageUrls.length > 0) ? product.imageUrls[0] : 'https://placehold.co/400?text=No+Image';
             const el = document.createElement('div');
             el.className = 'bg-white rounded-xl shadow-sm overflow-hidden border border-gray-100 transition hover:shadow-md cursor-pointer';
             el.onclick = () => openGallery(product);
             el.innerHTML = `
                <div class="relative h-48 bg-gray-100 overflow-hidden">
                    <img src="${img}" alt="${product.name}" class="w-full h-full object-cover transition duration-500 hover:scale-105" loading="lazy">
                </div>
                <div class="p-4">
                    <p class="text-xs font-bold text-teal-600 uppercase tracking-wider mb-1">${product.category}</p>
                    <h3 class="text-gray-900 font-medium truncate">${product.name}</h3>
                    <p class="text-lg font-extrabold text-gray-900 mt-2">${product.price || 'â‚¹ --'}</p>
                </div>
             `;
             elements.productGrid.appendChild(el);
        });
    }

    // Modals & Navigation
    function openGallery(product) {
        const img = (product.imageUrls && product.imageUrls.length > 0) ? product.imageUrls[0] : 'https://placehold.co/600?text=No+Image';
        document.getElementById('gallery-main-image').src = img;
        document.getElementById('gallery-title').textContent = product.name;
        document.getElementById('gallery-price').textContent = product.price;
        document.getElementById('gallery-category-badge').textContent = `${product.category} / ${product.subcategory}`;
        document.getElementById('gallery-description').textContent = product.description;
        document.getElementById('gallery-buy-btn').onclick = (e) => { e.preventDefault(); showBuyMsg(product.name); };

        const thumbs = document.getElementById('gallery-thumbnails');
        thumbs.innerHTML = '';
        if (product.imageUrls && product.imageUrls.length > 1) {
            product.imageUrls.forEach(url => {
                const t = document.createElement('img');
                t.src = url; t.className = 'w-14 h-14 object-cover rounded-md border-2 border-transparent hover:border-teal-500 cursor-pointer';
                t.onclick = () => document.getElementById('gallery-main-image').src = url;
                thumbs.appendChild(t);
            });
        }
        elements.galleryModal.classList.remove('hidden');
    }

    window.closeProductGallery = () => elements.galleryModal.classList.add('hidden');
    window.showBuyMsg = (name) => {
        closeProductGallery();
        document.getElementById('purchase-message-text').innerHTML = `Interested in <strong>${name}</strong>?<br>Please contact us on WhatsApp or check our Amazon/Meesho store links on the About page.`;
        elements.purchaseModal.classList.remove('hidden');
    }
    window.closePurchaseModal = () => elements.purchaseModal.classList.add('hidden');
    window.showView = (view) => {
        elements.productPage.classList.toggle('hidden', view !== 'products');
        elements.aboutPage.classList.toggle('hidden', view !== 'about');
        elements.navProducts.classList.toggle('nav-active', view === 'products');
        elements.navProducts.classList.toggle('text-gray-500', view !== 'products');
        elements.navAbout.classList.toggle('nav-active', view === 'about');
        elements.navAbout.classList.toggle('text-gray-500', view !== 'about');
    }
    function showError(msg) { elements.errorMsg.textContent = msg; elements.errorMsg.classList.remove('hidden'); elements.skeletonLoader.classList.add('hidden'); }

    document.addEventListener('DOMContentLoaded', initApp);
</script>
</body>
</html>


