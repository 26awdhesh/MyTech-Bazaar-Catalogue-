<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyTech Gadgets Catalog</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .scroll-container::-webkit-scrollbar { display: none; }
        .scroll-container { -ms-overflow-style: none; scrollbar-width: none; }
        .nav-active {
            border-bottom-width: 2px;
            border-color: #0d9488; /* Teal-600 */
            color: #0d9488;
            font-weight: 600;
        }
        .gallery-thumbnail {
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.2s;
        }
        .gallery-thumbnail-active {
            border-color: #0d9488; /* Teal-600 */
        }
    </style>
</head>
<body class="antialiased">

<!-- Main App Container -->
<div id="app" class="min-h-screen pb-16">

    <!-- Header / Branding & Navigation -->
    <header class="sticky top-0 z-30 bg-white shadow-lg">
        <div class="max-w-4xl mx-auto p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between">
            <h1 class="text-3xl font-extrabold text-teal-700 tracking-tight text-center sm:text-left">
                <span class="text-gray-900">MyTech</span> Gadgets
            </h1>
            <nav class="mt-3 sm:mt-0 flex justify-center space-x-6 sm:space-x-8">
                <button id="nav-products" onclick="showView('products')" class="nav-btn text-lg py-1 transition nav-active">
                    Products
                </button>
                <button id="nav-about" onclick="showView('about')" class="nav-btn text-lg py-1 text-gray-500 hover:text-teal-600 transition">
                    About Me
                </button>
            </nav>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 mt-6">

        <!-- ======================= -->
        <!-- ==  PRODUCT PAGE  == -->
        <!-- ======================= -->
        <div id="product-page">
            <section class="mb-6 p-5 bg-white rounded-xl shadow-md border border-gray-100">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Our Digital Catalog</h2>
                <p class="text-gray-600">
                    Welcome! All products are sourced directly by me. As an Easy Ship seller on Amazon and a seller on Meesho and Snapdeal, I stand by the quality of every item. Click any product for more details.
                </p>
            </section>

            <!-- Main Category Tabs -->
            <div id="main-category-tabs" class="mb-4 overflow-x-auto whitespace-nowrap scroll-container border-b border-gray-200 pb-3">
                <button onclick="filterProducts('All', 'All')" id="category-All"
                    class="category-btn inline-flex items-center px-4 py-2 mr-2 text-sm font-medium rounded-full transition bg-teal-600 text-white shadow-md hover:bg-teal-700">
                    All Products
                </button>
                <!-- Main Category buttons will be rendered here by JS -->
            </div>

            <!-- Sub Category Tabs -->
            <div id="subcategory-container" class="mb-6 overflow-x-auto whitespace-nowrap scroll-container hidden">
                <h3 class="text-sm font-medium text-gray-500 mb-2">Refine by Sub-Type:</h3>
                <div id="subcategory-buttons" class="flex">
                    <!-- Subcategory buttons will be rendered here by JS -->
                </div>
            </div>

            <!-- Product Display Grid -->
            <section id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Loading Spinner -->
                <div id="loading-spinner" class="col-span-1 sm:col-span-2 lg:col-span-3 text-center p-12">
                    <svg class="mx-auto h-12 w-12 text-teal-600 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <h3 class="mt-2 text-lg font-medium text-gray-900">Loading Products...</h3>
                </div>
            </section>
            
            <!-- Empty State Message -->
            <div id="status-message" class="text-center p-12 hidden">
                <!-- ... (same as before) ... -->
            </div>
        </div>

        <!-- ======================= -->
        <!-- ==  ABOUT ME PAGE  == -->
        <!-- ======================= -->
        <div id="about-page" class="hidden">
            <!-- ... (About Me page content remains the same) ... -->
            <section class="mb-6 p-6 bg-white rounded-xl shadow-lg border border-gray-100">
                <h2 class="text-3xl font-bold text-teal-700 mb-4">About MyTech Gadgets</h2>
                <div class="space-y-4 text-gray-700">
                    <p>
                        Hello! I'm the owner of **MyTech Gadgets**, your trusted source for the latest in electronics and accessories in India. My passion is bringing high-quality, reliable tech to you at affordable prices.
                    </p>
                    <p>
                        I started as a seller on platforms like Amazon, Snapdeal, and Meesho, and this catalog is my way of sharing my curated product list directly with you. Browse my collection and feel free to reach out with any questions!
                    </p>
                </div>
            </section>
            <section class="mb-6 p-6 bg-white rounded-xl shadow-lg border border-gray-100">
                <h3 class="text-2xl font-bold text-gray-800 mb-5">Contact & Storefronts</h3>
                <div class="space-y-5">
                    <div class="flex items-center">
                        <span class="flex-shrink-0 w-10 h-10 bg-teal-100 text-teal-600 rounded-full flex items-center justify-center">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                        </span>
                        <div class="ml-4">
                            <h4 class="text-lg font-medium text-gray-900">Email Me</h4>
                            <p class="text-gray-600">mytech-gadgets@example.com</p>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <span class="flex-shrink-0 w-10 h-10 bg-teal-100 text-teal-600 rounded-full flex items-center justify-center">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                        </span>
                        <div class="ml-4">
                            <h4 class="text-lg font-medium text-gray-900">Call or WhatsApp</h4>
                            <p class="text-gray-600">+91 98765 43210</p>
                        </div>
                    </div>
                    <h4 class="text-xl font-semibold text-gray-800 pt-4 border-t mt-6">Find me on:</h4>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <a href="#" class="group block p-4 bg-gray-50 hover:bg-white hover:shadow-md rounded-lg border border-gray-200 transition duration-150">
                            <img src="https://placehold.co/100x40/f3f4f6/000000?text=Amazon.in&font=sans-serif" alt="Amazon Logo" class="h-8 mx-auto mb-2 opacity-70 group-hover:opacity-100">
                            <p class="text-center text-sm font-medium text-gray-600 group-hover:text-teal-600">MyTech Gadgets Store</p>
                        </a>
                        <a href="#" class="group block p-4 bg-gray-50 hover:bg-white hover:shadow-md rounded-lg border border-gray-200 transition duration-150">
                            <img src="https://placehold.co/100x40/f3f4f6/e11d48?text=Snapdeal&font=sans-serif" alt="Snapdeal Logo" class="h-8 mx-auto mb-2 opacity-70 group-hover:opacity-100">
                            <p class="text-center text-sm font-medium text-gray-600 group-hover:text-teal-600">MyTech Seller Profile</p>
                        </a>
                        <a href="#" class="group block p-4 bg-gray-50 hover:bg-white hover:shadow-md rounded-lg border border-gray-200 transition duration-150">
                            <img src="https://placehold.co/100x40/f3f4f6/f472b6?text=Meesho&font=sans-serif" alt="Meesho Logo" class="h-8 mx-auto mb-2 opacity-70 group-hover:opacity-100">
                            <p class="text-center text-sm font-medium text-gray-600 group-hover:text-teal-600">MyTech Gadgets Shop</p>
                        </a>
                    </div>
                </div>
            </section>
        </div>
    </main>

</div>

<!-- ========================= -->
<!-- ==  PRODUCT GALLERY MODAL == -->
<!-- ========================= -->
<div id="product-gallery-modal" class="fixed inset-0 z-40 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 hidden" onclick="closeProductGallery()">
    <div class="bg-white rounded-xl shadow-2xl overflow-hidden w-full max-w-lg m-auto transform transition-all duration-300 scale-95" onclick="event.stopPropagation()">
        
        <button onclick="closeProductGallery()" class="absolute top-2 right-2 z-50 text-white bg-gray-800 bg-opacity-50 rounded-full w-8 h-8 flex items-center justify-center hover:bg-opacity-75 transition">
            &times;
        </button>
        
        <!-- Main Product Image -->
        <img id="gallery-main-image" src="https://placehold.co/600x400/14b8a6/ffffff?text=Product+Image" alt="Product Image" 
             class="w-full h-64 object-cover">
        
        <!-- Image Thumbnail Gallery -->
        <div id="gallery-thumbnails" class="flex space-x-2 p-2 bg-gray-100 overflow-x-auto">
            <!-- Thumbnails will be rendered here by JS -->
        </div>
        
        <!-- Product Details -->
        <div class="p-5">
            <div class="flex justify-between items-start mb-3">
                <h3 id="gallery-title" class="text-2xl font-bold text-gray-900">Product Name</h3>
                <p id="gallery-price" class="text-2xl font-extrabold text-green-600 flex-shrink-0 ml-4">â‚¹0</p>
            </div>
            
            <span id="gallery-category-badge" class="inline-block px-3 py-1 mb-3 text-sm font-semibold rounded-full bg-teal-100 text-teal-700">
                Category / Subcategory
            </span>
            
            <p id="gallery-description" class="text-gray-600 text-base mb-6">
                Full product description...
            </p>

            <a id="gallery-buy-btn" href="#"
                class="block w-full text-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-lg font-medium text-white bg-rose-600 hover:bg-rose-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-rose-500 transition duration-150">
                Inquire / Buy Now
            </a>
        </div>
    </div>
</div>

<!-- Purchase Message Modal (Same as before) -->
<div id="purchase-message-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center p-4 hidden">
    <!-- ... (modal content is the same) ... -->
</div>


<!-- Firebase SDK -->
<script type="module">
    // Import Firebase services
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, onSnapshot, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // --- Global State ---
    let currentCategory = 'All';
    let currentSubcategory = 'All';
    let allProducts = []; // This will be filled from Firestore

    // --- DOM Elements ---
    const productGrid = document.getElementById('product-grid');
    const mainCategoryContainer = document.getElementById('main-category-tabs');
    const subcategoryContainer = document.getElementById('subcategory-container');
    const subcategoryButtonsDiv = document.getElementById('subcategory-buttons');
    const statusMessage = document.getElementById('status-message');
    const productPage = document.getElementById('product-page');
    const aboutPage = document.getElementById('about-page');
    const navProducts = document.getElementById('nav-products');
    const navAbout = document.getElementById('nav-about');
    const galleryModal = document.getElementById('product-gallery-modal');
    const purchaseModal = document.getElementById('purchase-message-modal');
    const loadingSpinner = document.getElementById('loading-spinner');

    // --- Firebase Initialization ---
    // These global variables are provided by the environment
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
    const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

    let db, auth;
    const productsCollectionPath = `/artifacts/${appId}/public/data/products`;

    async function initializeFirebase() {
        if (Object.keys(firebaseConfig).length === 0) {
            console.error("Firebase config is missing!");
            loadingSpinner.innerHTML = "<p class='text-red-500'>Error: Firebase configuration is missing. Cannot load products.</p>";
            return;
        }

        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            setLogLevel('debug'); // Enable detailed logs

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    console.log("User is authenticated:", user.uid);
                    fetchProducts(db); // Fetch products once user is authenticated
                } else {
                    console.log("User is not authenticated.");
                }
            });

            if (initialAuthToken) {
                await signInWithCustomToken(auth, initialAuthToken);
            } else {
                await signInAnonymously(auth);
            }
        } catch (error) {
            console.error("Firebase Init Error:", error);
            loadingSpinner.innerHTML = `<p class='text-red-500'>Error: ${error.message}</p>`;
        }
    }

    // --- Data Fetching ---
    function fetchProducts(db) {
        const productsRef = collection(db, productsCollectionPath);
        
        onSnapshot(productsRef, (querySnapshot) => {
            allProducts = []; // Clear current products
            querySnapshot.forEach((doc) => {
                allProducts.push({ id: doc.id, ...doc.data() });
            });
            
            console.log("Fetched products:", allProducts);
            loadingSpinner.classList.add('hidden'); // Hide spinner
            
            // Re-render UI with new data
            renderCategoryButtons();
            filterProducts(currentCategory, currentSubcategory);
            
        }, (error) => {
            console.error("Error fetching products:", error);
            loadingSpinner.innerHTML = `<p class='text-red-500'>Error loading products. Check console for details.</p>`;
        });
    }

    // --- Page Navigation ---
    window.showView = (viewName) => {
        if (viewName === 'products') {
            productPage.classList.remove('hidden');
            aboutPage.classList.add('hidden');
            navProducts.classList.add('nav-active');
            navAbout.classList.remove('nav-active');
        } else if (viewName === 'about') {
            productPage.classList.add('hidden');
            aboutPage.classList.remove('hidden');
            navProducts.classList.remove('nav-active');
            navAbout.classList.add('nav-active');
        }
    }

    // --- Filtering Functions ---

    // 1. Render Main Category Buttons
    function renderCategoryButtons() {
        const categories = [...new Set(allProducts.map(p => p.category))];
        
        // Clear old buttons (except 'All Products')
        mainCategoryContainer.querySelectorAll('.category-btn:not(#category-All)').forEach(btn => btn.remove());

        categories.forEach(category => {
            const button = document.createElement('button');
            button.className = 'category-btn inline-flex items-center px-4 py-2 mr-2 text-sm font-medium rounded-full transition bg-white text-gray-700 hover:bg-teal-50 hover:text-teal-700 shadow-sm border';
            button.id = `category-${category.replace(/\s/g, '')}`;
            button.textContent = category;
            button.onclick = () => filterProducts(category, 'All');
            mainCategoryContainer.appendChild(button);
        });
    }

    // 2. Render Subcategory Buttons
    function renderSubcategoryButtons(category) {
        // ... (This function logic remains the same as before) ...
        subcategoryButtonsDiv.innerHTML = ''; 
        if (category === 'All') { subcategoryContainer.classList.add('hidden'); return; }
        const subcategories = [...new Set(allProducts.filter(p => p.category === category).map(p => p.subcategory))].filter(sub => sub);
        if (subcategories.length === 0) { subcategoryContainer.classList.add('hidden'); return; }
        subcategoryContainer.classList.remove('hidden');
        const allSubBtn = document.createElement('button');
        allSubBtn.className = 'subcategory-btn inline-flex items-center px-4 py-2 mr-2 text-sm font-medium rounded-full transition bg-teal-600 text-white shadow-sm hover:bg-teal-700';
        allSubBtn.id = `subcategory-All`;
        allSubBtn.textContent = `All ${category}`;
        allSubBtn.onclick = () => filterProducts(category, 'All');
        subcategoryButtonsDiv.appendChild(allSubBtn);
        subcategories.forEach(sub => {
            const button = document.createElement('button');
            button.className = 'subcategory-btn inline-flex items-center px-4 py-2 mr-2 text-sm font-medium rounded-full transition bg-white text-gray-700 hover:bg-teal-50 hover:text-teal-700 shadow-sm border';
            button.id = `subcategory-${sub.replace(/\s/g, '')}`;
            button.textContent = sub;
            button.onclick = () => filterProducts(category, sub);
            subcategoryButtonsDiv.appendChild(button);
        });
    }

    // 3. Main Filter Function
    window.filterProducts = (category, subcategory) => {
        // ... (This function logic remains the same as before, but uses `allProducts`) ...
        const categoryChanged = currentCategory !== category;
        currentCategory = category;
        currentSubcategory = subcategory;
        let filtered = allProducts;
        if (currentCategory !== 'All') filtered = filtered.filter(p => p.category === currentCategory);
        if (